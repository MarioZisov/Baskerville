@model Baskerville.Models.ViewModels.StatisticsViewModel

@{
    ViewBag.Title = "Home Page";
}

<div class="row">
    <div class="col-md-6">
        <div id="piechart" style="width: 600px; height: 450px;"></div>
    </div>
</div>

<div class="label-select">
    <label class="inline-label"> Покажи данни за @Html.DropDownList("Year", new SelectList(Model.YearsRange), new { @class = "form-control input-sm inline-select", @id = "test" }) годинa </label>
</div>

<div class="row">
    <div class="col-md-12">
        <div id="chart_div"></div>
    </div>
</div>


@section scripts
{
    <script type="text/javascript" src="https://www.gstatic.com/charts/loader.js"></script>

    <script type="text/javascript">
        google.charts.load('current', { 'packages': ['corechart', 'bar'] });
        google.charts.setOnLoadCallback(drawPieChart);
        google.charts.setOnLoadCallback(drawBarChart);       

        $('#test').change(drawBarChart)

        function drawPieChart() {

            var dataPC = google.visualization.arrayToDataTable([
              ['Task', 'Hours per Day'],
              ['Български', @Model.BulgarianSpeakersCount],
              ['Английски', @Model.EnglishSpeakersCount],
            ]);

            var optionsPC = {
                //title: 'My Daily Activities'
            };

            var pieChart = new google.visualization.PieChart(document.getElementById('piechart'));

            pieChart.draw(dataPC, optionsPC);
        }

        function drawBarChart() {
            y = document.getElementById("test").value;           

            var row = "";
            var rows = new Array();
            rows.push( [ "Месец", "Посещения", "Нови Абонати" ] );

            $.getJSON("MontlyData", { year: y }, function (data) {
                $.each(data, function (index, element) {
                    row = [element.Month, parseInt(element.HitsCount), parseInt(element.SubscribesCount)];
                    rows.push(row);
                })

                var gData = google.visualization.arrayToDataTable(rows);

                var optionsBC = {
                    barChart: {
                        //title: 'Company Performance',
                        //subtitle: 'Sales, Expenses, and Profit: 2014-2017',
                    },
                    bars: 'vertical',
                    vAxis: { format: 'short' },
                    height: 400,
                    width: 1250,
                    colors: ['#1b9e77', '#d95f02']
                };

                var barChart = new google.charts.Bar(document.getElementById('chart_div'));
                barChart.draw(gData, google.charts.Bar.convertOptions(optionsBC));
            })
        }
    </script>
}